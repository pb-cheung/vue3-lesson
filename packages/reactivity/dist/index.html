<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
  </head>

  <body>
    <div id="app"></div>
    <script type="module">
      // è¿™æ˜¯åŸç”Ÿçš„
      // import {
      //   reactive,
      //   effect,
      // } from '/node_modules/@vue/reactivity/dist/reactivity.esm-browser.js';

      // è¿™æ˜¯è‡ªå·±å®ç°è°ƒè¯•ç”¨çš„
      import { reactive, effect } from './reactivity.js';

      // reactive è®©æ•°æ®å˜æˆå“åº”å¼çš„
      // effect å‰¯ä½œç”¨ æ•°æ®å˜åŒ–åå¯ä»¥è®©effecté‡æ–°æ‰§è¡Œï¼Œç»„ä»¶ã€watchã€computedéƒ½æ˜¯åŸºäºeffectæ¥å®ç°
      // console.log(reactive({name: "pb", age: 30 }));

      // const state = reactive({name: "pb", age: 30 });
      // effect(() => {
      //     app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`
      // });
      // setTimeout(() => {
      //     state.age ++; // æ•°æ®å˜åŒ–åeffectä¼šå†æ¬¡é‡æ–°æ‰§è¡Œ
      // }, 1000);

      // é˜²æ­¢é‡å¤ä»£ç†ï¼Œç¼“å­˜ä»£ç†å¯¹è±¡
      // let obj = {name: "jw", age: 30 };
      // const state1 = reactive(obj);
      // const state2 = reactive(obj);
      // console.log(state1 === state2);

      // // é˜²æ­¢ä»£ç†è¿‡çš„å¯¹è±¡å†æ¬¡è¢«ä»£ç†
      // let obj = { name: 'pb', age: 30 };
      // const state1 = reactive(obj);
      // // å¦‚æœstate1è¢«ä»£ç†è¿‡åï¼Œä¸€å®šæœ‰getå’Œsetäº†
      // const state2 = reactive(state1);
      // console.log(state1 === state2);

      // const state = reactive({ name: 'pb', age: 30 });
      // console.log(state.name, state.age);
      // effect(() => {
      //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
      // });

      // let obj = { name: 'pb', age: 30 };
      // const state = reactive(obj);
      // const _effect = effect(() => {
      //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
      // });
      // state.age++;
      // _effect.run();

      // effect(() => {
      //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
      // });
      // setTimeout(() => {
      //   state.age++; // æ•°æ®å˜åŒ–åeffectä¼šå†æ¬¡é‡æ–°æ‰§è¡Œ
      // }, 1000);

      // effect(() => {
      //   // f1
      //   console.log(state.name);

      //   effect(() => {
      //     // f2
      //     console.log(state.name);
      //   });

      //   // f2æ‰§è¡Œå®Œæ¯•åï¼ŒæŠŠactiveEffectç½®ä¸ºäº†undefinedï¼Œå°±æ— æ³•è¿›è¡Œä¾èµ–(f1 -> age)æœé›†äº†
      //   // å¯ä»¥ä½¿ç”¨é€’å½’æˆ–è€…å †æ ˆè§£å†³
      //   console.log(state.age);
      // });

      // let obj = { name: 'pb', age: 30 };
      // const state = reactive(obj);
      // effect(() => {
      //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
      // });
      // // effect(() => {
      // //   app.innerHTML = `å§“å${state.name}`;
      // // });
      // setTimeout(() => {
      //   state.age++; // æ•°æ®å˜åŒ–åeffectä¼šå†æ¬¡é‡æ–°æ‰§è¡Œ
      // }, 1000);

      // lesson-9
      // eg: é—®é¢˜1ï¼šåˆ†æ”¯è¯­å¥å¯¼è‡´effectä¾èµ–çš„å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå¦‚ä½•æ›´æ–°ä¾èµ–
      // let obj = { name: 'pb', age: 30, flag: true };
      // const state = reactive(obj);
      // effect(() => {
      //   console.log("ğŸš€ ~ effect obj:", state)
      //   app.innerHTML = state.flag ? state.name : state.age;
      // });
      // // ä¾èµ–å…³ç³»ï¼š
      // // obj: { flag: { effect }, name: { effect } }
      // // ç¬¬ä¸€ä¸ªsetTimeoutå›è°ƒå‡½æ‰§è¡Œåï¼Œè§¦å‘effectå‡½æ•°æ‰§è¡Œåï¼Œä¾èµ–å…³ç³»å˜ä¸ºï¼š
      // // obj: { flag: { effect }, name: { effect }, age: { effect } }
      // setTimeout(() => {
      //   state.flag = false;

      //   setTimeout(() => {
      //     console.log("ä¿®æ”¹nameå±æ€§åï¼Œä¸åº”è¯¥è§¦å‘effectå‡½æ•°æ‰§è¡Œ", )
      //     state.name = 'handsome pb'; // ä¿®æ”¹nameå±æ€§åï¼Œä¸åº”è¯¥è§¦å‘effectå‡½æ•°æ‰§è¡Œ
      //   }, 1000);

      // }, 1000);
      // æ‰“å°ä¿¡æ¯å¯ä»¥çœ‹åˆ°ä¸‰è¡Œï¼š
      // ğŸš€ ~ effect obj: Proxy(Object)Â {name: 'pb', age: 30, flag: true}
      // ğŸš€ ~ effect obj: Proxy(Object)Â {name: 'pb', age: 30, flag: false}
      // ğŸš€ ~ effect obj: Proxy(Object)Â {name: 'handsome pb', age: 30, flag: false}

      // æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç®—æ³•ï¼Œæ¥æ¯”å¯¹ä¸åŒåˆ†æ”¯è¯­å¥åˆ‡æ¢çš„æ—¶å€™çš„å·®å¼‚
      // eg: é—®é¢˜2ï¼šå…ˆè§£å†³ä¸€ä¸ªeffectä¸­å¤šæ¬¡å¼•ç”¨åŒä¸ªå±æ€§å¯¼è‡´çš„é‡å¤å°†åŒä¸ªeffectæ·»åŠ åˆ°ä¾èµ–çš„é—®é¢˜
      // effect(() => {
      //   app.innerHTML = state.flag + state.flag + state.flag;
      // }); // trackEffectä¼šè°ƒç”¨3æ¬¡ï¼Œå°†è¿™ä¸ªeffectæ·»åŠ åˆ°flagçš„depä¸Š3æ¬¡

      // lesson-10 effectè°ƒåº¦å®ç°
      // let obj = { name: 'pb', age: 30, flag: true };
      // const state = reactive(obj);
      // let runner = effect(
      //   () => {
      //     app.innerHTML = state.flag ? state.name : state.age;
      //   },
      //   {
      //     scheduler: () => {
      //       console.log('æ•°æ®æ›´æ–°äº†ï¼Œä¸é‡æ–°æ¸²æŸ“ï¼Œèµ°è‡ªå·±çš„é€»è¾‘'); // AOPç¼–ç¨‹
      //       runner(); // é‡æ–°æ¸²æŸ“
      //     },
      //   }
      // );
      // setTimeout(() => {
      //   state.flag = false;
      //   state.age = 100;
      // }, 1000);
      // lesson-10 effect è°ƒåº¦å™¨çš„ç”¨æ³•
      // const state = reactive({ count: 0 });
      // let isScheduling = false;
      // const runner = effect(
      //   () => {
      //     console.log(`æœ€ç»ˆ count: ${state.count}`);
      //   },
      //   {
      //     scheduler: () => {
      //       if (!isScheduling) {
      //         isScheduling = true;
      //         // ä½¿ç”¨å¾®ä»»åŠ¡å»¶è¿Ÿæ‰§è¡Œï¼Œåˆå¹¶å¤šæ¬¡ä¿®æ”¹
      //         Promise.resolve().then(() => {
      //           runner(); // æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆç­‰ä»·äº runner()ï¼‰
      //           isScheduling = false;
      //         });
      //       }
      //     },
      //   }
      // );
      // // çŸ­æ—¶é—´å†…å¤šæ¬¡ä¿®æ”¹
      // state.count = 1;
      // state.count = 2;
      // state.count = 3;
      // state.count = 4;
      // state.count = 5;
      // // æœ€ç»ˆ count: 0 // åˆšæ³¨å†Œæ‰§è¡Œä¸€æ¬¡
      // // æœ€ç»ˆ count: 5 // æ‰€æœ‰åŒæ­¥çš„ä¿®æ”¹ä¹‹åï¼Œæ‰§è¡Œä¸€æ¬¡

      // lesson-11 æ·±åº¦ä»£ç†
      let obj = { name: 'pb', address: { n: 10010 } };
      const state = reactive(obj);
      // 11-1 é˜²æ­¢é€’å½’è°ƒç”¨
      // effect(() => {
      //   app.innerHTML = state.name;
      //   state.name = Math.random(); // æœ¬æ¬¡åœ¨æ‰§è¡Œeffectçš„æ—¶å€™ï¼Œæ›´æ–°äº†æ•°æ®ï¼Œå¦‚æœä¸åšå¤„ç†ä¼šæ— é™å¾ªç¯ï¼Œå†…å­˜è¶…é™æŠ¥é”™ç»ˆæ­¢
      //   // è§£å†³æ–¹æ³•ï¼šeffectç±»ä¸­æ·»åŠ å±æ€§ï¼ˆ_runningsï¼‰è®°å½•æ‰§è¡ŒçŠ¶æ€ï¼Œeffectçš„è°ƒåº¦æ‰§è¡Œå‰æ£€æŸ¥æ­¤å±æ€§
      //   // æ‰§è¡Œä¼˜åŒ–åè¿™ç§æƒ…å†µä¸ä¼šè§¦å‘effectæ›´æ–°
      // });
      // 11-2 æ·±å±‚ä»£ç†
      // ç›®å‰åªæœ‰objå†…ç¬¬ä¸€å±‚å±æ€§ï¼ˆname,addressï¼‰æ·»åŠ äº†ä»£ç†ï¼Œå†æ·±å±‚æ²¡æœ‰
      // è§£å†³æ–¹æ³•ï¼šgetterä¸­åˆ¤æ–­ï¼Œå–çš„å€¼æ˜¯å¯¹è±¡çš„æƒ…å†µï¼Œä½¿ç”¨reactiveå‡½æ•°ç»™è¿™ä¸ªå€¼æ·»åŠ ä»£ç†ï¼Œé€’å½’
      // effect(() => {
      //   app.innerHTML = state.address.n;
      // });
      // setTimeout(() => {
      //   state.address.n = 58001;
      // }, 1000);
    </script>
  </body>
</html>
