<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Title</title>
</head>

<body>
  <div id="app"></div>
  <script type="module">
    // è¿™æ˜¯åŽŸç”Ÿçš„
    // import { reactive, effect } from '/node_modules/@vue/reactivity/dist/reactivity.esm-browser.js';

    // è¿™æ˜¯è‡ªå·±å®žçŽ°è°ƒè¯•ç”¨çš„
    import { reactive, effect } from './reactivity.js';

    // reactive è®©æ•°æ®å˜æˆå“åº”å¼çš„
    // effect å‰¯ä½œç”¨ æ•°æ®å˜åŒ–åŽå¯ä»¥è®©effecté‡æ–°æ‰§è¡Œï¼Œç»„ä»¶ã€watchã€computedéƒ½æ˜¯åŸºäºŽeffectæ¥å®žçŽ°
    // console.log(reactive({name: "pb", age: 30 }));

    // const state = reactive({name: "pb", age: 30 });
    // effect(() => {
    //     app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`
    // });
    // setTimeout(() => {
    //     state.age ++; // æ•°æ®å˜åŒ–åŽeffectä¼šå†æ¬¡é‡æ–°æ‰§è¡Œ
    // }, 1000);

    // é˜²æ­¢é‡å¤ä»£ç†ï¼Œç¼“å­˜ä»£ç†å¯¹è±¡
    // let obj = {name: "jw", age: 30 };
    // const state1 = reactive(obj);
    // const state2 = reactive(obj);
    // console.log(state1 === state2);

    // // é˜²æ­¢ä»£ç†è¿‡çš„å¯¹è±¡å†æ¬¡è¢«ä»£ç†
    // let obj = { name: 'pb', age: 30 };
    // const state1 = reactive(obj);
    // // å¦‚æžœstate1è¢«ä»£ç†è¿‡åŽï¼Œä¸€å®šæœ‰getå’Œsetäº†
    // const state2 = reactive(state1);
    // console.log(state1 === state2);

    // const state = reactive({ name: 'pb', age: 30 });
    // console.log(state.name, state.age);
    // effect(() => {
    //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
    // });

    // let obj = { name: 'pb', age: 30 };
    // const state = reactive(obj);
    // const _effect = effect(() => {
    //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
    // });
    // state.age++;
    // _effect.run();

    // effect(() => {
    //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
    // });
    // setTimeout(() => {
    //   state.age++; // æ•°æ®å˜åŒ–åŽeffectä¼šå†æ¬¡é‡æ–°æ‰§è¡Œ
    // }, 1000);

    // effect(() => {
    //   // f1
    //   console.log(state.name);

    //   effect(() => {
    //     // f2
    //     console.log(state.name);
    //   });

    //   // f2æ‰§è¡Œå®Œæ¯•åŽï¼ŒæŠŠactiveEffectç½®ä¸ºäº†undefinedï¼Œå°±æ— æ³•è¿›è¡Œä¾èµ–(f1 -> age)æœé›†äº†
    //   // å¯ä»¥ä½¿ç”¨é€’å½’æˆ–è€…å †æ ˆè§£å†³
    //   console.log(state.age);
    // });

    // let obj = { name: 'pb', age: 30 };
    // const state = reactive(obj);
    // effect(() => {
    //   app.innerHTML = `å§“å${state.name} å¹´é¾„${state.age}`;
    // });
    // // effect(() => {
    // //   app.innerHTML = `å§“å${state.name}`;
    // // });
    // setTimeout(() => {
    //   state.age++; // æ•°æ®å˜åŒ–åŽeffectä¼šå†æ¬¡é‡æ–°æ‰§è¡Œ
    // }, 1000);

    // lesson-9
    // eg: é—®é¢˜1ï¼šåˆ†æ”¯è¯­å¥å¯¼è‡´effectä¾èµ–çš„å±žæ€§å‘ç”Ÿå˜åŒ–ï¼Œå¦‚ä½•æ›´æ–°ä¾èµ–
    let obj = { name: 'pb', age: 30, flag: true };
    const state = reactive(obj);
    effect(() => {
      console.log("ðŸš€ ~ effect obj:", state)
      app.innerHTML = state.flag ? state.name : state.age;
    });
    // ä¾èµ–å…³ç³»ï¼š
    // obj: { flag: { effect }, name: { effect } }
    // ç¬¬ä¸€ä¸ªsetTimeoutå›žè°ƒå‡½æ‰§è¡ŒåŽï¼Œè§¦å‘effectå‡½æ•°æ‰§è¡ŒåŽï¼Œä¾èµ–å…³ç³»å˜ä¸ºï¼š
    // obj: { flag: { effect }, name: { effect }, age: { effect } }
    setTimeout(() => {
      state.flag = false;

      setTimeout(() => {
        console.log("ä¿®æ”¹nameå±žæ€§åŽï¼Œä¸åº”è¯¥è§¦å‘effectå‡½æ•°æ‰§è¡Œ", )
        state.name = 'handsome pb'; // ä¿®æ”¹nameå±žæ€§åŽï¼Œä¸åº”è¯¥è§¦å‘effectå‡½æ•°æ‰§è¡Œ
      }, 1000);

    }, 1000);
    // æ‰“å°ä¿¡æ¯å¯ä»¥çœ‹åˆ°ä¸‰è¡Œï¼š
    // ðŸš€ ~ effect obj: Proxy(Object)Â {name: 'pb', age: 30, flag: true}
    // ðŸš€ ~ effect obj: Proxy(Object)Â {name: 'pb', age: 30, flag: false}
    // ðŸš€ ~ effect obj: Proxy(Object)Â {name: 'handsome pb', age: 30, flag: false}

    // æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç®—æ³•ï¼Œæ¥æ¯”å¯¹ä¸åŒåˆ†æ”¯è¯­å¥åˆ‡æ¢çš„æ—¶å€™çš„å·®å¼‚      
    // eg: é—®é¢˜2ï¼šå…ˆè§£å†³ä¸€ä¸ªeffectä¸­å¤šæ¬¡å¼•ç”¨åŒä¸ªå±žæ€§å¯¼è‡´çš„é‡å¤å°†åŒä¸ªeffectæ·»åŠ åˆ°ä¾èµ–çš„é—®é¢˜
    // effect(() => {
    //   app.innerHTML = state.flag + state.flag + state.flag;
    // }); // trackEffectä¼šè°ƒç”¨3æ¬¡ï¼Œå°†è¿™ä¸ªeffectæ·»åŠ åˆ°flagçš„depä¸Š3æ¬¡


  </script>
</body>

</html>