<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>async-comp</title>
  </head>

  <body>
    <div id="app"></div>
    <script type="module">
      // import {
      //   render,
      //   h,
      //   Text,
      //   defineAsyncComponent,
      // } from '/node_modules/vue/dist/vue.runtime.esm-browser.js';

      import {
        render,
        h,
        Text,
        Fragment,
        defineAsyncComponent,
      } from './runtime-dom.js';

      const comp = import('./asyncComponent.js');
      console.log('üöÄ ~ file: async-comp.html ~ line 25 ~ comp', comp);

      const count = 2; // Âä†ËΩΩÈáçËØïÊ¨°Êï∞
      let i = 0;

      // lesson-50 ÂºÇÊ≠•ÁªÑ‰ª∂
      // ÂºÇÊ≠•ÁªÑ‰ª∂ÁöÑÂéüÁêÜÂíåÂõæÁâáÊáíÂä†ËΩΩÁ±ª‰ºº
      // Âü∫‰∫éÁä∂ÊÄÅÊù•ÂÆûÁé∞ loaded ? h(ÁªÑ‰ª∂): h(Á©∫ËäÇÁÇπ)
      // const MyComponent = defineAsyncComponent(() => comp);
      const MyComponent = defineAsyncComponent({
        loader: () => {
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              // resolve({
              //   render: () => {
              //     return h('div', 'Hello Async Component');
              //   },
              // });

              // È™åËØÅÂä†ËΩΩÂºÇÂ∏∏Â§ÑÁêÜÈÄªËæë
              // reject({
              //   render: () => {
              //     return h('div', 'Hello Async Component');
              //   },
              // });

              // È™åËØÅË∂ÖÊó∂Â§±Ë¥•
              // resolve({
              //   render: () => {
              //     return h('div', 'Hello Async Component');
              //   },
              // });

              // È™åËØÅÂä†ËΩΩÈîôËØØÂ§ÑÁêÜÂáΩÊï∞
              if (i++ === count) {
                resolve({
                  render: () => {
                    return h('div', 'Hello Async Component');
                  },
                });
              } else {
                reject({
                  render: () => {
                    return h('div', 'Hello Async Component');
                  },
                });
              }
            }, 3000);
          });
        },
        timeout: 1000,
        errorComponent: {
          render: () => {
            return h('div', 'Error component');
          },
        },
        delay: 500, // 500msÂÜÖÂ¶ÇÊûúÁªÑ‰ª∂Ê≤°ÊúâÂä†ËΩΩÂá∫Êù•ÔºåÊòæÁ§∫loading
        loadingComponent: {
          render: () => {
            return h('div', 'Loading...');
          },
        },
        onError(err, retry, fail, attempts) {
          console.error(
            'Error loading async component:',
            err,
            retry,
            fail,
            attempts
          );
          setTimeout(() => {
            retry();
            console.log('ÈáçÊñ∞Âä†ËΩΩ‰∏≠...');
          }, 1000);
        },
      });

      //
      render(h(MyComponent), app);
    </script>
  </body>
</html>
