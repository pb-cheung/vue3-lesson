<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>life-cycle</title>
</head>

<body>
  <div id="app"></div>
  <script type="module">
    // import {
    //   render,
    //   h,
    //   createVNode,
    //   ref,
    //   Text,
    //   Fragment,
    //   Teleport,
    //   provide,
    //   inject,
    //   onBeforeMount,
    //   onMounted,
    //   onBeforeUpdate,
    //   onUpdated,
    // } from '/node_modules/vue/dist/vue.runtime.esm-browser.js';

    import {
      render,
      h,
      Text,
      ref,
      Fragment,
      Teleport,
      provide,
      inject,
      onBeforeMount,
      onMounted,
      onBeforeUpdate,
      onUpdated,
      getCurrentInstance,
    } from './runtime-dom.js';

    // lesson-45 ç”Ÿå‘½å‘¨æœŸé’©å­å®ç°

    // çˆ¶åˆå§‹åŒ– å­åˆå§‹åŒ– çˆ¶å®Œæˆ
    // çˆ¶æ›´æ–° å­æ›´æ–° å­å®Œæˆ çˆ¶å®Œæˆ
    const ChildComponent = {
      props: {
        value: String,
      },
      setup(props, { emit, expose, slots, attrs }) {
        console.log('child setup');
        console.log(getCurrentInstance(), 'child instance in setup');
        // instance -> é’©å­å…³è”åœ¨ä¸€èµ·ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºè°ƒç”¨å¯¹åº”çš„é’©å­
        onBeforeMount(() => {
          console.log("ğŸš€ ~ onBeforeMount ~ child ~ instance: ", getCurrentInstance());
          console.log('child beforeMount');
        });
        onMounted(() => {
          console.log('child mounted');
        });
        onBeforeUpdate(() => {
          console.log('child onBeforeUpdate');
        });
        onUpdated(() => {
          console.log('child onUpdated');
        });
        return () => {
          return h('div', props.value);
        };
      },
    };

    // lesson-44 ç»„åˆå¼å‡½æ•°çš„ä¼˜ç‚¹ä½“ç°ï¼Œå¯ä»¥æŠŠé’©å­å‡½æ•°å•ç‹¬æŠ½ç¦»ä½¿ç”¨
    const parentHook = () => {
      // instance -> é’©å­å…³è”åœ¨ä¸€èµ·ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºè°ƒç”¨å¯¹åº”çš„é’©å­
      onBeforeMount(() => {
        console.log("ğŸš€ ~ parent onBeforeMount ~ instance:", getCurrentInstance())
        console.log('parent onBeforeMount');
      });
      onMounted(() => {
        console.log('parent onMounted');
      });
      onBeforeUpdate(() => {
        console.log('parent onBeforeUpdate');
      });
      onUpdated(() => {
        console.log('parent onUpdated');
      });
    }

    const ParentComponent = {
      setup(props, { emit, expose, slots, attrs }) {
        console.log('parent setup');
        console.log(getCurrentInstance(), 'parent instance in setup');

        parentHook();

        const val = ref('a');
        setTimeout(() => {
          val.value = 'b';
        }, 3000);

        // return () => {
        //   return h('div', val.value);
        // };
        return () => {
          return h(ChildComponent, { value: val.value });
        };
      },
    };


    // const ParentComponent = {
    //   setup(props, { emit, expose, slots, attrs }) {
    //     console.log('parent setup');
    //     console.log(getCurrentInstance(), 'parent instance in setup');

    //     // instance -> é’©å­å…³è”åœ¨ä¸€èµ·ï¼Œåœ¨ç‰¹å®šçš„æ—¶æœºè°ƒç”¨å¯¹åº”çš„é’©å­
    //     onBeforeMount(() => {
    //       console.log('parent onBeforeMount');
    //     });
    //     onMounted(() => {
    //       console.log('parent onMounted');
    //     });
    //     onBeforeUpdate(() => {
    //       console.log('parent onBeforeUpdate');
    //     });
    //     onUpdated(() => {
    //       console.log('parent onUpdated');
    //     });

    //     const val = ref('a');
    //     setTimeout(() => {
    //       val.value = 'b';
    //     }, 3000);

    //     // return () => {
    //     //   return h('div', val.value);
    //     // };
    //     return () => {
    //       return h(ChildComponent, { value: val.value });
    //     };
    //   },
    // };

    render(h(ParentComponent), app);

    // æ‰“å°ä¿¡æ¯ï¼š
    //  parent setup
    //  parent beforeMount
    //  child setup
    //  child beforeMount
    //  child mounted
    //  parent mounted
    //  parent onBeforeUpdate
    //  child onBeforeUpdate
    //  child onUpdated
    //  parent onUpdated

    // çˆ¶ç»„ä»¶setup -> çˆ¶ç»„ä»¶æŒ‚è½½é‡åˆ°å­ç»„ä»¶ -> å­ç»„ä»¶setup -> å­ç»„ä»¶æŒ‚è½½ -> å­ç»„ä»¶æŒ‚è½½å®Œæˆ -> çˆ¶ç»„ä»¶ï¼ˆç»§ç»­æŒ‚è½½ï¼‰æŒ‚è½½å®Œæˆ

    // æ›´æ–°æµç¨‹ï¼šçˆ¶ç»„ä»¶æ›´æ–°é‡åˆ°å­ç»„ä»¶onBeforeUpdate -> å­ç»„ä»¶æ›´æ–°onBeforeUpdate -> å­ç»„ä»¶æ›´æ–°å®ŒæˆonUpdated -> çˆ¶ç»„ä»¶æ›´æ–°å®ŒæˆonUpdated
  </script>
</body>

</html>